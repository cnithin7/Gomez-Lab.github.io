---
title: "Galaxy Pipeline"
author: Armel
tags:
  - tutorial
  - Galaxy
  - Variant Calling
---

<!-- excerpt start -->

This guide provides a flexible workflow for analyzing next-generation sequencing (NGS) data using Galaxy. Customize placeholders (e.g., `[SPECIMEN_TYPE]`, `[DISEASE_TYPE]`) for your project.
<!-- excerpt end -->



## Tutorial Sections

- [General Prerequisites](#general-prerequisites)
- [1. Set Up Your Galaxy Environment](#set-up-your-galaxy-environment)
- [2. Understand Your Sequencing Data](#understand-your-sequencing-data)
- [3. Align Reads to a Reference Genome](#align-reads-to-a-reference-genome)
- [4. Call Variants](#call-variants)
- [5. Annotate Variants](#annotate-variants)
- [6. Visualize Variants](#visualize-variants)
- [7. Analyze and Interpret Results](#analyze-and-interpret-results)
- [8. Assessment (Optional)](#assessment-optional)
- [Tips for Customization](#tips-for-customization)
- [Suggested Illustrations](#suggested-illustrations)

---

## General Prerequisites

- **Objective**: Analyze NGS data to identify and interpret variants for `[SPECIFIC_PURPOSE, e.g., clinical reporting, research discovery]`.
- **Input Data**:
  - Paired-end FASTQ files: `[SAMPLE_NAME]_R1.fq`, `[SAMPLE_NAME]_R2.fq`
  - BED file: `[TARGET_REGIONS].bed` (defines regions of interest)
- **Tools Needed**:
  - [Galaxy](https://usegalaxy.org/) (Register, no download needed)
  - [IGV](https://igv.org/) (Download required)
  - [wANNOVAR](http://wannovar.wglab.org/) (Use institutional email)
  - [VEP](http://grch37.ensembl.org/Homo_sapiens/Tools/VEP) (Web-based)
  - Word/PowerPoint for documentation
- **Hardware**: Computer with 100MB–1GB storage, large or dual-monitor setup recommended.

---

## Set Up Your Galaxy Environment

**Goal**: Establish a workspace for data analysis.

**Steps**:
1. Visit [https://usegalaxy.org/](https://usegalaxy.org/) and click “Login or Register” to create an account (use Firefox, Chrome, or Safari).
2. Request your instructor/collaborator to share the dataset (e.g., `[SAMPLE_NAME]_R1.fq`, `[SAMPLE_NAME]_R2.fq`, `[TARGET_REGIONS].bed`) within Galaxy.
3. Access shared data:
   - “History” panel (right) > “Histories Shared with Me”
   - Select shared history > “View” > “Import History” > “Start Using This History”

**Customization**: Replace `[SAMPLE_NAME]` (e.g., `TumorSample1`) and `[TARGET_REGIONS]` (e.g., `CancerPanel.bed`).

**Illustration**: Screenshot of Galaxy homepage with arrows on “Login or Register” and “History” panel.

[Back to Tutorial Sections](#tutorial-sections)

---

## Understand Your Sequencing Data

**Goal**: Assess the quality and structure of raw sequencing data.

**Steps**:
1. **View FASTQ Data**:
   - In “History,” click the “eye” icon next to `[SAMPLE_NAME]_R1.fq`.
   - Examine FASTQ format:
   - - Record run number (e.g., 585).
- Interpret quality scores using [ASCII Phred table](http://drive5.com/usearch/manual/quality_score.html) (e.g., “5” = 1% error, “B” = 0.05% error).
2. **Run Quality Control**:
- Tools > “FASTQ Quality Control” > “FastQC Read Quality Reports”
- Input: `[SAMPLE_NAME]_R1.fq` > “Run Tool.” Repeat for `[SAMPLE_NAME]_R2.fq`.
- View “webpage” output and record:
- Total sequences
- Sequences flagged as poor quality
- Sequence length
- %GC content
- Assess quality metrics for concerns (e.g., low base quality).

**Customization**: Adjust quality thresholds based on project needs.

**Illustration**: FASTQ entry with annotations for each line, plus a FastQC plot with a red-flagged quality drop.

[Back to Tutorial Sections](#tutorial-sections)

---

## Align Reads to a Reference Genome

**Goal**: Map sequencing reads to a reference genome.

**Steps**:
1. **Align with BWA-MEM**:
- Tools > “Mapping” > “Map with BWA-MEM” (Version 0.7.17.1 or latest)
- Settings:
- Reference genome: `[REFERENCE_GENOME]` (e.g., `Human hg19`)
- Paired-end: Yes
- FASTQ files: `[SAMPLE_NAME]_R1.fq`, `[SAMPLE_NAME]_R2.fq`
- Run Tool (5–15 min). Output: `[SAMPLE_NAME].bam`
- Note size difference (e.g., 600MB vs. 1GB FASTQ due to compression).
2. **Sort the BAM File**:
- Tools > “Genomics ToolKits” > “Picard” > “SortSam” (Version 2.18.2.1)
- Input: `[SAMPLE_NAME].bam`
- Sort order: “Coordinate”
- Validation stringency: “Lenient”
- Run Tool
3. **Mark Duplicates**:
- Tools > “Picard” > “MarkDuplicates” (Version 2.18.2.1)
- Input: Sorted `[SAMPLE_NAME].bam`
- Run Tool. Outputs: Marked BAM, metrics file
- View metrics (e.g., % PCR duplicates).
4. **Remove Duplicates**:
- Tools > “SAM/BAM” > “RmDup” (Version 2.0.1)
- Input: Original `[SAMPLE_NAME].bam`
- Paired-end: Yes
- Run Tool. Compare sizes (e.g., % reduction vs. % duplicates).

**Customization**: Use a different genome (e.g., hg38) or aligner (e.g., Bowtie2).

**Illustration**: Flowchart: FASTQ → BAM → Sorted BAM → Duplicate-removed BAM, with file size annotations.

[Back to Tutorial Sections](#tutorial-sections)

---

## Call Variants

**Goal**: Identify genetic variants from aligned reads.

**Steps**:
1. **VarScan Workflow**:
- Tools > “SAM/BAM” > “Samtools mpileup” (Version 2.1.4)
- Input: Duplicate-removed `[SAMPLE_NAME].bam`
- Reference: `[REFERENCE_GENOME]`
- Run Tool → Output: Pileup file
- Tools > “Variant Calling” > “VarScan” (Version 2.4.2)
- Input: Pileup file
- Settings:
- Min read depth: 20
- Min supporting reads: 4
- Min base quality: 20
- Min variant frequency: 0.03
- Ignore >90% strand bias: Yes
- Run Tool → Output: `[SAMPLE_NAME]_VarScan.vcf`
2. **FreeBayes Workflow**:
- Tools > “Variant Calling” > “FreeBayes” (Version 1.1.0.46-0)
- Input: Duplicate-removed `[SAMPLE_NAME].bam`
- Reference: `[REFERENCE_GENOME]`
- Parameters: Simple diploid calling, Min coverage: 10
- Run Tool → Output: `[SAMPLE_NAME]_FreeBayes.vcf`
3. **Limit to Target Regions**:
- Tools > “VCF/BCF” > “VCF-BEDintersect” (Version 1.0.0)
- Inputs: Each VCF + `[TARGET_REGIONS].bed`
- Run Tool (twice). Outputs: Filtered VCFs
4. **Compare Variant Callers**:
- Click VCF files in History to view line counts.
- Record pre/post-BED intersect counts (e.g., VarScan: 9,535 → 48).

**Customization**: Add tools (e.g., GATK) or adjust thresholds.

**Illustration**: Table of variant counts, Venn diagram of caller overlap.

[Back to Tutorial Sections](#tutorial-sections)

---

## Annotate Variants

**Goal**: Add functional and clinical context to variants.

**Steps**:
1. **wANNOVAR Annotation**:
- Download filtered VCFs (e.g., `[SAMPLE_NAME]_VarScan.bed.vcf`) via “disk” icon.
- Visit [http://wannovar.wglab.org/](http://wannovar.wglab.org/), upload VCF (max 2 runs, use `[YOUR_EMAIL]`).
- Download “genome” CSV.
- In Excel:
- Hide columns K:CM
- Sort by `gnomad211_exome_AF`
- Filter `ExonicFunc.refGeneWithVer` (exclude “Synonymous SNV”)
- Filter `Func.refGeneWithVer` (exclude “intron”, “UTR3”)
2. **VEP Annotation**:
- Visit [http://grch37.ensembl.org/Homo_sapiens/Tools/VEP](http://grch37.ensembl.org/Homo_sapiens/Tools/VEP)
- Input: Paste variant (e.g., `chr7 55221822 55221822 C T`) or upload VCF
- Run and review annotations.
3. **Compare Results**:
- Identify shared and unique variants (e.g., TP53 hits).

**Customization**: Use SnpEff or filter by ClinVar.

**Illustration**: wANNOVAR input screenshot, filtered Excel table.

[Back to Tutorial Sections](#tutorial-sections)

---

## Visualize Variants

**Goal**: Inspect alignments and variants visually.

**Steps**:
1. **Slice BAM File**:
- Tools > “SAM/BAM” > “Slice BAM by genomic regions”
- Input: Original `[SAMPLE_NAME].bam` + `[TARGET_REGIONS].bed`
- Run Tool → Download `.bam` and `.bai`
2. **View in IGV**:
- Install [IGV](https://igv.org/), load `[REFERENCE_GENOME]` (e.g., hg19)
- Load `.bam` and `.bai` (same name/folder)
- Zoom to variant (e.g., `7:140434574`)
- Sort reads by base (right-click > “Group by base”)
- Check for artifacts (e.g., strand bias).

**Customization**: Adjust coordinates or use UCSC Browser.

**Illustration**: IGV screenshot with sorted reads, artifact annotations.

[Back to TOC](#table-of-contents)

---

## Analyze and Interpret Results

**Goal**: Generate insights for `[SPECIFIC_PURPOSE]`.

**Steps**:
1. Apply pipeline to your dataset (e.g., `[YOUR_SAMPLE]_R1.fq`).
2. Identify key variants (e.g., somatic, actionable).
3. Compare with external data (e.g., COSMIC, clinical reports).
4. Document in a report/presentation.

**Customization**: Focus on your goal (e.g., cancer, rare disease).

**Illustration**: Pipeline flowchart with decision points.

[Back to Tutorial Sections](#tutorial-sections)

---

## Assessment (Optional)

**Goal**: Present findings.

**Steps**:
1. Create a 15-minute presentation (e.g., PowerPoint):
- Scenario and testing rationale
- Quality metrics
- Variant interpretation
- Comparison with reference data
2. Include variant details: `g.`, `c.`, `p.` positions, genome build.

**Customization**: Tailor to your audience.

**Illustration**: Sample slide with variant table, quality graph.

[Back to Tutorial Sections](#tutorial-sections)

---

## Tips for Customization

- **Scenario**: Replace glioblastoma with your case (e.g., “Breast cancer study”).
- **Data**: Use your FASTQ/BED files, adjust names/sizes.
- **Tools**: Swap tools (e.g., GATK) or references (e.g., hg38).
- **Output**: Modify deliverables (e.g., research paper).

[Back to Tutorial Sections](#tutorial-sections)

---


For further assistance, adapt this pipeline and contact `fgomez@wustl.edu`!
